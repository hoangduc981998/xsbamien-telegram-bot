# ğŸ° XS Ba Miá»n - Bot Telegram Tra Cá»©u Xá»• Sá»‘ 3 Miá»n

<div align="center">

![Python Version](https://img.shields.io/badge/python-3.12-blue.svg)
![Telegram Bot API](https://img.shields.io/badge/Telegram%20Bot%20API-21.0-blue.svg)
![License](https://img.shields.io/badge/license-MIT-green.svg)
![Status](https://img.shields.io/badge/status-active-success.svg)

**Bot Telegram tra cá»©u káº¿t quáº£ xá»• sá»‘ nhanh chÃ³ng, chÃ­nh xÃ¡c cho cáº£ 3 miá»n Báº¯c - Trung - Nam**

[Demo](#-demo) â€¢ [TÃ­nh NÄƒng](#-tÃ­nh-nÄƒng) â€¢ [CÃ i Äáº·t](#-cÃ i-Ä‘áº·t) â€¢ [Sá»­ Dá»¥ng](#-sá»­-dá»¥ng) â€¢ [ÄÃ³ng GÃ³p](#-Ä‘Ã³ng-gÃ³p)

</div>

---

## ğŸ“– Giá»›i Thiá»‡u

**XS Ba Miá»n Bot** lÃ  bot Telegram giÃºp tra cá»©u káº¿t quáº£ xá»• sá»‘ cá»±c nhanh, há»— trá»£ Ä‘áº§y Ä‘á»§:
- ğŸ”´ **Miá»n Báº¯c** (1 tá»‰nh)
- ğŸŸ  **Miá»n Trung** (14 tá»‰nh)  
- ğŸŸ¢ **Miá»n Nam** (21 tá»‰nh)

### âœ¨ Äiá»ƒm Ná»•i Báº­t
- âš¡ **Pháº£n há»“i cá»±c nhanh** - DÆ°á»›i 2 giÃ¢y
- ğŸ¨ **Giao diá»‡n Ä‘áº¹p** - Inline keyboards chuyÃªn nghiá»‡p
- ğŸ“Š **Thá»‘ng kÃª chi tiáº¿t** - LÃ´ 2 sá»‘, 3 sá»‘, Ä‘áº§u-Ä‘uÃ´i, lÃ´ gan
- ğŸ”” **Nháº¯c nhá»Ÿ tá»± Ä‘á»™ng** - ThÃ´ng bÃ¡o khi cÃ³ káº¿t quáº£ má»›i
- ğŸŒ **Open Source** - Miá»…n phÃ­, phá»¥c vá»¥ cá»™ng Ä‘á»“ng

---

## ğŸ¯ TÃ­nh NÄƒng

### ğŸ° Tra Cá»©u Káº¿t Quáº£
- âœ… Káº¿t quáº£ hÃ´m nay theo miá»n
- âœ… Káº¿t quáº£ theo tá»‰nh/thÃ nh cá»¥ thá»ƒ
- âœ… Lá»‹ch sá»­ 30 ká»³ gáº§n nháº¥t
- âœ… Hiá»ƒn thá»‹ Ä‘áº¹p máº¯t vá»›i báº£ng Unicode

### ğŸ“Š Thá»‘ng KÃª & PhÃ¢n TÃ­ch
- âœ… **LÃ´ 2 Sá»‘** - Táº§n suáº¥t vÃ  phÃ¢n bá»‘ sá»‘ 2 chá»¯ sá»‘
- âœ… **LÃ´ 3 Sá»‘** - PhÃ¢n tÃ­ch ba cÃ ng (3 chá»¯ sá»‘)
- âœ… **Äáº§u LÃ´ / ÄuÃ´i LÃ´** - Thá»‘ng kÃª theo chá»¯ sá»‘ Ä‘áº§u/Ä‘uÃ´i
- âœ… **LÃ´ Gan** - Sá»‘ lÃ¢u khÃ´ng vá» (database-powered - real statistics!)
- âœ… **Hot/Cold Numbers** - Sá»‘ nÃ³ng/láº¡nh tá»« dá»¯ liá»‡u thá»±c
- âœ… **Frequency Analysis** - PhÃ¢n tÃ­ch táº§n suáº¥t xuáº¥t hiá»‡n

_ğŸ“ Chi tiáº¿t xem [STATISTICS.md](docs/STATISTICS.md)_

### ğŸ—„ï¸ Database & Historical Data (NEW!)
- âœ… **PostgreSQL Integration** - LÆ°u trá»¯ lá»‹ch sá»­ 100+ ngÃ y
- âœ… **Real Statistics** - Thá»‘ng kÃª tá»« dá»¯ liá»‡u thá»±c (khÃ´ng mock)
- âœ… **Fast Queries** - Indexes tá»‘i Æ°u cho truy váº¥n nhanh
- âœ… **MU88 API Crawler** - Thu tháº­p dá»¯ liá»‡u há»£p phÃ¡p 100%
- âœ… **CLI Tools** - Quáº£n lÃ½ database dá»… dÃ ng

_ğŸ“ Chi tiáº¿t xem [DATABASE.md](docs/DATABASE.md)_

### ğŸ”” ThÃ´ng BÃ¡o ThÃ´ng Minh
- â° Nháº¯c trÆ°á»›c giá» quay (15 phÃºt)
- ğŸŠ ThÃ´ng bÃ¡o káº¿t quáº£ ngay khi cÃ³
- ğŸ¯ ÄÄƒng kÃ½ theo tá»‰nh yÃªu thÃ­ch

### ğŸ“… Lá»‹ch Quay ThÆ°á»Ÿng
- ğŸŸ¢ **Miá»n Nam**: 16:15 - 16:45
- ğŸŸ  **Miá»n Trung**: 17:15 - 17:45
- ğŸ”´ **Miá»n Báº¯c**: 18:15 - 18:30

---

## ğŸš€ CÃ i Äáº·t

### YÃªu Cáº§u
- Python 3.12+
- Telegram Bot Token ([Táº¡o bot](https://t.me/BotFather))
- PostgreSQL 13+ (tÃ¹y chá»n, cho database features)
- Redis (tÃ¹y chá»n, cho production cache)

### CÃ i Äáº·t Nhanh

#### 1ï¸âƒ£ Clone Repository
```bash
git clone https://github.com/hoangduc981998/xsbamien-telegram-bot.git
cd xsbamien-telegram-bot
```

#### 2ï¸âƒ£ CÃ i Äáº·t Dependencies
```bash
pip install -r requirements.txt
```

#### 3ï¸âƒ£ Cáº¥u HÃ¬nh
```bash
cp .env.example .env
nano .env  # ThÃªm TELEGRAM_BOT_TOKEN
```

#### 4ï¸âƒ£ Cháº¡y Bot
```bash
python -m app.main
```

### ğŸ—„ï¸ Setup Database (TÃ¹y Chá»n - Cho Thá»‘ng KÃª NÃ¢ng Cao)

#### 1ï¸âƒ£ CÃ i PostgreSQL
```bash
# Ubuntu/Debian
sudo apt install postgresql postgresql-contrib

# macOS
brew install postgresql@15

# Docker
docker run --name lottery-postgres \
  -e POSTGRES_PASSWORD=lottery_pass \
  -e POSTGRES_USER=lottery_user \
  -e POSTGRES_DB=lottery_db \
  -p 5432:5432 -d postgres:15-alpine
```

#### 2ï¸âƒ£ Khá»Ÿi Táº¡o Database
```bash
# Cáº¥u hÃ¬nh .env
echo "DATABASE_URL=postgresql+asyncpg://lottery_user:lottery_pass@localhost:5432/lottery_db" >> .env
echo "USE_DATABASE=true" >> .env

# Cháº¡y migrations
python -m alembic upgrade head
```

#### 3ï¸âƒ£ Táº£i Dá»¯ Liá»‡u Lá»‹ch Sá»­ (100 ngÃ y)
```bash
# Táº£i táº¥t cáº£ tá»‰nh (36 tá»‰nh Ã— 100 ngÃ y)
python scripts/load_historical_data.py --days 100 --all

# Hoáº·c chá»‰ 1 miá»n
python scripts/load_historical_data.py --days 100 --region MN

# Hoáº·c 1 tá»‰nh cá»¥ thá»ƒ
python scripts/load_historical_data.py --days 100 --province MB
```

_ğŸ“ Xem thÃªm: [DATABASE.md](docs/DATABASE.md) Ä‘á»ƒ biáº¿t chi tiáº¿t_

### ğŸ³ Cháº¡y Vá»›i Docker

```bash
docker-compose up -d
```

---

## ğŸ§ª Running Tests

### Install dev dependencies
```bash
pip install -r requirements-dev.txt
```

### Run all tests
```bash
pytest
```

### Run with coverage
```bash
pytest --cov=app --cov-report=html
```

### Run specific test file
```bash
pytest tests/test_keyboards.py -v
```

### View coverage report
```bash
open htmlcov/index.html  # macOS
xdg-open htmlcov/index.html  # Linux
```

See [tests/README.md](tests/README.md) for detailed testing documentation.

---

## ğŸ’¡ Sá»­ Dá»¥ng

### Lá»‡nh CÆ¡ Báº£n

| Lá»‡nh | MÃ´ Táº£ |
|------|-------|
| `/start` | Khá»Ÿi Ä‘á»™ng bot, hiá»‡n menu chÃ­nh |
| `/help` | Xem hÆ°á»›ng dáº«n chi tiáº¿t |
| `/mb` | Káº¿t quáº£ Miá»n Báº¯c hÃ´m nay |
| `/mt` | Káº¿t quáº£ Miá»n Trung hÃ´m nay |
| `/mn` | Káº¿t quáº£ Miá»n Nam hÃ´m nay |

### Tra Cá»©u Nhanh

```
/latest TPHCM          # Ká»³ má»›i nháº¥t TP.HCM
/province DANA         # Káº¿t quáº£ ÄÃ  Náºµng
/stats MIBA 2digit     # Thá»‘ng kÃª lÃ´ 2 sá»‘ Miá»n Báº¯c
```

### ÄÄƒng KÃ½ Nháº¯c Nhá»Ÿ

```
/subscribe TPHCM       # Nháº­n thÃ´ng bÃ¡o TP.HCM
/unsubscribe TPHCM     # Há»§y nháº­n thÃ´ng bÃ¡o
/mysubs                # Xem danh sÃ¡ch Ä‘Ã£ Ä‘Äƒng kÃ½
```

---

## ğŸ—ï¸ Kiáº¿n TrÃºc

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Telegram   â”‚
â”‚   Users     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Bot Layer (PTB v21)         â”‚
â”‚  â€¢ Command Handlers             â”‚
â”‚  â€¢ Callback Handlers            â”‚
â”‚  â€¢ Error Handlers               â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Service Layer              â”‚
â”‚  â€¢ Mu88Client (API)             â”‚
â”‚  â€¢ Cache (Redis/SQLite)         â”‚
â”‚  â€¢ Stats Service                â”‚
â”‚  â€¢ Scheduler (APScheduler)      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Data Layer                â”‚
â”‚  â€¢ API mu88.live                â”‚
â”‚  â€¢ Redis Cache                  â”‚
â”‚  â€¢ SQLite (fallback)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—‚ï¸ Cáº¥u TrÃºc Dá»± Ãn

```
xsbamien-telegram-bot/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py              # Entry point
â”‚   â”œâ”€â”€ config.py            # Cáº¥u hÃ¬nh toÃ n cá»¥c
â”‚   â”‚
â”‚   â”œâ”€â”€ ui/                  # UI/UX Layer
â”‚   â”‚   â”œâ”€â”€ keyboards.py     # Inline keyboards
â”‚   â”‚   â”œâ”€â”€ messages.py      # Message templates
â”‚   â”‚   â””â”€â”€ formatters.py    # Format káº¿t quáº£
â”‚   â”‚
â”‚   â”œâ”€â”€ handlers/            # Request Handlers
â”‚   â”‚   â”œâ”€â”€ commands.py      # Command handlers
â”‚   â”‚   â”œâ”€â”€ callbacks.py     # Callback handlers
â”‚   â”‚   â””â”€â”€ errors.py        # Error handlers
â”‚   â”‚
â”‚   â”œâ”€â”€ services/            # Business Logic
â”‚   â”‚   â”œâ”€â”€ mu88_client.py   # API client
â”‚   â”‚   â”œâ”€â”€ cache.py         # Cache layer
â”‚   â”‚   â”œâ”€â”€ stats.py         # Thá»‘ng kÃª
â”‚   â”‚   â””â”€â”€ subscription.py  # ÄÄƒng kÃ½ nháº¯c
â”‚   â”‚
â”‚   â””â”€â”€ models/              # Data Models
â”‚       â””â”€â”€ lottery.py       # Pydantic models
â”‚
â”œâ”€â”€ tests/                   # Unit tests
â”œâ”€â”€ docs/                    # Documentation
â”œâ”€â”€ .env.example             # Environment template
â”œâ”€â”€ requirements.txt         # Python dependencies
â”œâ”€â”€ Dockerfile               # Docker build
â””â”€â”€ docker-compose.yml       # Docker orchestration
```

---

## ğŸ“Š Danh SÃ¡ch Tá»‰nh/ThÃ nh

### ğŸ”´ Miá»n Báº¯c (1)
- `MIBA` - Miá»n Báº¯c

### ğŸŸ¢ Miá»n Nam (21)
`TPHCM`, `BALI`, `BETR`, `ANGI`, `BIDU`, `BIPH`, `BITH`, `CAMA`, `CATH`, `DALAT`, `DONA`, `DOTH`, `HAGI`, `KIGI`, `LOAN`, `SOTR`, `TANI`, `TIGI`, `TRVI`, `VILO`, `VUTA`

### ğŸŸ  Miá»n Trung (14)
`DANA`, `BIDI`, `DALAK`, `DANO`, `GILA`, `KHHO`, `KOTU`, `NITH`, `PHYE`, `QUBI`, `QUNA`, `QUNG`, `QUTR`, `THTH`

---

## ğŸ› ï¸ Tech Stack

- **Language**: Python 3.12
- **Bot Framework**: [python-telegram-bot](https://python-telegram-bot.org/) v21
- **HTTP Client**: httpx
- **Cache**: Redis / SQLite
- **Scheduler**: APScheduler
- **Validation**: Pydantic
- **Metrics**: Prometheus
- **Container**: Docker

---

## ğŸ—“ï¸ Roadmap

### âœ… Phase 1 - MVP (HoÃ n ThÃ nh)
- [x] Cáº¥u trÃºc dá»± Ã¡n
- [x] UI/UX vá»›i inline keyboards
- [x] Commands cÆ¡ báº£n
- [x] Mock data demo

### ğŸš§ Phase 2 - Core Features (Äang PhÃ¡t Triá»ƒn)
- [ ] TÃ­ch há»£p API mu88.live
- [ ] Cache layer (Redis)
- [ ] Thá»‘ng kÃª cÆ¡ báº£n
- [ ] Lá»‹ch quay thÆ°á»Ÿng

### ğŸ“‹ Phase 3 - Advanced Features
- [ ] Subscription system
- [ ] APScheduler jobs
- [ ] Metrics & monitoring
- [ ] Admin dashboard

### ğŸ¨ Phase 4 - Polish
- [ ] i18n (Tiáº¿ng Viá»‡t/English)
- [ ] Export áº£nh káº¿t quáº£
- [ ] Grafana dashboard
- [ ] Load testing

---

## ğŸ¤ ÄÃ³ng GÃ³p

Má»i Ä‘Ã³ng gÃ³p Ä‘á»u Ä‘Æ°á»£c hoan nghÃªnh! 

### CÃ¡ch ÄÃ³ng GÃ³p
1. Fork dá»± Ã¡n
2. Táº¡o branch má»›i (`git checkout -b feature/AmazingFeature`)
3. Commit thay Ä‘á»•i (`git commit -m 'Add some AmazingFeature'`)
4. Push lÃªn branch (`git push origin feature/AmazingFeature`)
5. Táº¡o Pull Request

### Quy Táº¯c Code
- TuÃ¢n thá»§ PEP 8
- Comment báº±ng tiáº¿ng Viá»‡t
- Viáº¿t docstring Ä‘áº§y Ä‘á»§
- Test trÆ°á»›c khi commit

---

## ğŸ“ License

Dá»± Ã¡n nÃ y Ä‘Æ°á»£c phÃ¢n phá»‘i dÆ°á»›i giáº¥y phÃ©p MIT. Xem file `LICENSE` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t.

---

## ğŸ‘¨â€ğŸ’» TÃ¡c Giáº£

**HoÃ ng Äá»©c**
- GitHub: [@hoangduc981998](https://github.com/hoangduc981998)
- Telegram: [Coming Soon]

---

## ğŸ™ Lá»i Cáº£m Æ n

- [python-telegram-bot](https://github.com/python-telegram-bot/python-telegram-bot) - Amazing bot framework
- [mu88.live](https://mu88.live) - API data source
- Cá»™ng Ä‘á»“ng Python Viá»‡t Nam

---

## ğŸ“ LiÃªn Há»‡ & Há»— Trá»£

- ğŸ› **Bug Reports**: [GitHub Issues](https://github.com/hoangduc981998/xsbamien-telegram-bot/issues)
- ğŸ’¡ **Feature Requests**: [GitHub Discussions](https://github.com/hoangduc981998/xsbamien-telegram-bot/discussions)
- ğŸ“§ **Email**: [Coming Soon]

---

<div align="center">

**â­ Náº¿u dá»± Ã¡n há»¯u Ã­ch, hÃ£y cho má»™t ngÃ´i sao! â­**

Made with â¤ï¸ for Vietnamese Lottery Community

</div>
## ğŸ“¸ Screenshots

### Main Menu
![Main Menu](docs/screenshots/main-menu.png)

### Miá»n Báº¯c Results
![MB Results](docs/screenshots/mb-results.png)

### LÃ´ 2 Sá»‘
![Lo 2](docs/screenshots/lo2.png)

### Features Demo
- âœ… Real-time lottery results
- âœ… Statistical analysis
- âœ… User-friendly interface
- âœ… Support for all 63 provinces
